{% extends "blog/base.html" %}
{% load humanize %}
{% block content %}
<article class="media content-section">
    <img class="rounded-circle article-img" src="#" alt="">
    <div class="media-body">
        <div class="article-metadata">
            <a class="mr-2" href="#">{{ object.author }}</a>
            <small class="text-muted">{{ object.published_date|date:"F d, Y" }}</small>
            {% if object.author == user %}
            <div>
                <a class="btn btn-secondary btn-sm mt-1 mb-1" href="#">Update</a>
                <a class="btn btn-danger btn-sm mt-1 mb-1" href="#">Delete</a>
            </div>

            {% endif %}
        </div>
        <h2 class="article-title">{{ object.title }}</h2>
        <p class="article-content">{{ object.content }}</p>
    </div>
</article>

{% if user.is_authenticated %}
<form method="POST" action="{% url 'add-comment' post.id %}">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">Post Comment</button>
</form>
{% else %}
<p>You must be logged in to comment.</p>
{% endif %}

<h4 class="mt-4">Comments ({{ post.comment_set.count }})</h4>
<ul class="list-group">
    {% for comment in post.comment_set.all %}
    <li class="list-group-item">
        <strong>{{ comment.author.username }}</strong> - {{ comment.created_at|naturaltime }}<br>
        {{ comment.content|linebreaks }}
        {% if comment.author == user %}
        <div class="mt-2">
            <a href="{% url 'edit-comment' comment.id %}" class="btn btn-sm btn-secondary">Edit</a>
            <a href="{% url 'delete-comment' comment.id %}" class="btn btn-sm btn-danger">Delete</a>
        </div>
        {% endif %}
    </li>
    {% empty %}
    <li class="list-group-item">No comments yet.</li>
    {% endfor %}
</ul>


<p><strong>Tags:</strong>
    {% for tag in post.tags.all %}
    <a href="{% url 'posts-by-tag' tag.slug %}">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
    {% endfor %}
</p>

{% endblock content%}